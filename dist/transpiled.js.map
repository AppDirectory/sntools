{"version":3,"sources":["../lib/sntools.js"],"names":["SNTools","crypto","window","msCrypto","buf","Uint32Array","getRandomValues","idx","replace","c","r","v","toString","d","Date","getTime","performance","now","uuid","Math","random","floor","html","tmp","document","implementation","createHTMLDocument","body","innerHTML","textContent","innerText","string","xmlDoc","DOMParser","parser","parseFromString","ActiveXObject","async","loadXML","data","filename","textFile","makeTextFile","text","Blob","type","URL","revokeObjectURL","createObjectURL","file","JSON","stringify","link","createElement","setAttribute","href","click","loadXMLString","xmlNotes","getElementsByTagName","notes","tags","findTag","title","filter","tag","content","addTag","push","xmlNote","childNodes","nodeValue","created","updated","contentXml","strip","note","created_at","moment","toDate","updated_at","generateUUID","content_type","references","xmlTags","tagXml","tagName","itemsData","items","concat"],"mappings":"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","file":"transpiled.js","sourcesContent":["class SNTools {\n\n  generateUUID() {\n    var crypto = window.crypto || window.msCrypto;\n    if(crypto) {\n      var buf = new Uint32Array(4);\n      crypto.getRandomValues(buf);\n      var idx = -1;\n      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n          idx++;\n          var r = (buf[idx>>3] >> ((idx%8)*4))&15;\n          var v = c == 'x' ? r : (r&0x3|0x8);\n          return v.toString(16);\n      });\n    } else {\n      var d = new Date().getTime();\n      if(window.performance && typeof window.performance.now === \"function\"){\n        d += performance.now(); //use high-precision timer if available\n      }\n      var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n        var r = (d + Math.random()*16)%16 | 0;\n        d = Math.floor(d/16);\n        return (c=='x' ? r : (r&0x3|0x8)).toString(16);\n      });\n      return uuid;\n    }\n  }\n\n  strip(html) {\n     var tmp = document.implementation.createHTMLDocument(\"New\").body;\n     tmp.innerHTML = html;\n     return tmp.textContent || tmp.innerText || \"\";\n  }\n\n  loadXMLString(string) {\n    var xmlDoc;\n    if (window.DOMParser) {\n      var parser = new DOMParser();\n      xmlDoc = parser.parseFromString(string, \"text/xml\");\n    } else {\n      // Internet Explorer\n      xmlDoc = new ActiveXObject(\"Microsoft.XMLDOM\");\n      xmlDoc.async = false;\n      xmlDoc.loadXML(string);\n    }\n\n    return xmlDoc;\n  }\n\n  downloadSNData(data, filename) {\n    var textFile = null;\n    var makeTextFile = function (text) {\n      var data = new Blob([text], {type: 'text/json'});\n\n      // If we are replacing a previously generated file we need to\n      // manually revoke the object URL to avoid memory leaks.\n      if (textFile !== null) {\n        window.URL.revokeObjectURL(textFile);\n      }\n\n      textFile = window.URL.createObjectURL(data);\n\n      // returns a URL you can use as a href\n      return textFile;\n    }\n\n    var file = makeTextFile(JSON.stringify(data, null, 2 /* pretty print */));\n\n    var link = document.createElement('a');\n    link.setAttribute('download', filename);\n    link.href = file;\n    link.click();\n  }\n\n  convertENEXDatatoSN(data) {\n    var xmlDoc = this.loadXMLString(data);\n    var xmlNotes = xmlDoc.getElementsByTagName(\"note\");\n    var notes = [];\n    var tags = [];\n\n    function findTag(title) {\n      return tags.filter(function(tag){\n        return tag.content.title == title;\n      })[0];\n    }\n\n    function addTag(tag) {\n      tags.push(tag);\n    }\n\n    for(var xmlNote of xmlNotes) {\n      var title = xmlNote.getElementsByTagName(\"title\")[0].childNodes[0].nodeValue;\n      var created = xmlNote.getElementsByTagName(\"created\")[0].childNodes[0].nodeValue;\n      var updated = xmlNote.getElementsByTagName(\"updated\")[0].childNodes[0].nodeValue;\n\n      var contentXml = this.loadXMLString(xmlNote.getElementsByTagName(\"content\")[0].childNodes[0].nodeValue);\n      var text = this.strip(contentXml.getElementsByTagName(\"en-note\")[0].innerHTML);\n\n      var note = {\n        created_at: moment(created).toDate(),\n        updated_at: moment(updated).toDate(),\n        uuid: this.generateUUID(),\n        content_type: \"Note\",\n        content: {\n          title: title,\n          text: text,\n          references: [],\n        }\n      };\n\n      var xmlTags = xmlNote.getElementsByTagName(\"tag\");\n      for(var tagXml of xmlTags) {\n        var tagName = tagXml.childNodes[0].nodeValue;\n        var tag = findTag(tagName);\n        if(!tag) {\n          tag = {\n            uuid: this.generateUUID(),\n            content_type: \"Tag\",\n            created_at: new Date(),\n            updated_at: new Date(),\n            content: {\n              title: tagName,\n              references: []\n            }\n          }\n          addTag(tag);\n        }\n\n        note.content.references.push({content_type: tag.content_type, uuid: tag.uuid})\n        tag.content.references.push({content_type: note.content_type, uuid: note.uuid})\n      }\n\n      notes.push(note);\n    }\n\n    var itemsData = {\n      items: notes.concat(tags)\n    }\n\n    return itemsData;\n  }\n}\n\nwindow.SNTools = new SNTools()\n"]}