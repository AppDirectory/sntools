{"version":3,"sources":["../lib/sntools.js"],"names":["SNTools","crypto","window","msCrypto","buf","Uint32Array","getRandomValues","idx","replace","c","r","v","toString","d","Date","getTime","performance","now","uuid","Math","random","floor","html","tmp","document","implementation","createHTMLDocument","body","innerHTML","textContent","innerText","string","type","xmlDoc","DOMParser","parser","parseFromString","ActiveXObject","async","loadXML","data","filename","textFile","makeTextFile","text","Blob","URL","revokeObjectURL","createObjectURL","file","JSON","stringify","link","createElement","setAttribute","href","appendChild","click","removeChild","loadXMLString","xmlNotes","getElementsByTagName","notes","tags","findTag","title","filter","tag","content","addTag","push","xmlNote","childNodes","nodeValue","created","updatedNodes","updated","length","contentXmlString","contentXml","contentHTML","strip","note","created_at","moment","toDate","updated_at","generateUUID","content_type","references","xmlTags","tagXml","tagName","itemsData","items","concat","files","completion","index","processedData","readNext","reader","FileReader","onload","e","target","result","name","split","bind","readAsText"],"mappings":"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","file":"transpiled.js","sourcesContent":["class SNTools {\n\n  generateUUID() {\n    var crypto = window.crypto || window.msCrypto;\n    if(crypto) {\n      var buf = new Uint32Array(4);\n      crypto.getRandomValues(buf);\n      var idx = -1;\n      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n          idx++;\n          var r = (buf[idx>>3] >> ((idx%8)*4))&15;\n          var v = c == 'x' ? r : (r&0x3|0x8);\n          return v.toString(16);\n      });\n    } else {\n      var d = new Date().getTime();\n      if(window.performance && typeof window.performance.now === \"function\"){\n        d += performance.now(); //use high-precision timer if available\n      }\n      var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n        var r = (d + Math.random()*16)%16 | 0;\n        d = Math.floor(d/16);\n        return (c=='x' ? r : (r&0x3|0x8)).toString(16);\n      });\n      return uuid;\n    }\n  }\n\n  strip(html) {\n     var tmp = document.implementation.createHTMLDocument(\"New\").body;\n     tmp.innerHTML = html;\n     return tmp.textContent || tmp.innerText || \"\";\n  }\n\n  loadXMLString(string, type) {\n    var xmlDoc;\n    if (window.DOMParser) {\n      var parser = new DOMParser();\n      xmlDoc = parser.parseFromString(string, \"text/\" + type);\n    } else {\n      // Internet Explorer\n      xmlDoc = new ActiveXObject(\"Microsoft.XMLDOM\");\n      xmlDoc.async = false;\n      xmlDoc.loadXML(string);\n    }\n\n    return xmlDoc;\n  }\n\n  downloadSNData(data, filename) {\n    var textFile = null;\n    var makeTextFile = function (text) {\n      var data = new Blob([text], {type: 'text/json'});\n\n      // If we are replacing a previously generated file we need to\n      // manually revoke the object URL to avoid memory leaks.\n      if (textFile !== null) {\n        window.URL.revokeObjectURL(textFile);\n      }\n\n      textFile = window.URL.createObjectURL(data);\n\n      // returns a URL you can use as a href\n      return textFile;\n    }\n\n    var file = makeTextFile(JSON.stringify(data, null, 2 /* pretty print */));\n\n    var link = document.createElement('a');\n    link.setAttribute('download', filename);\n    link.href = file;\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n  }\n\n  convertENEXDatatoSN(data) {\n    var xmlDoc = this.loadXMLString(data, \"xml\");\n    var xmlNotes = xmlDoc.getElementsByTagName(\"note\");\n    var notes = [];\n    var tags = [];\n\n    function findTag(title) {\n      return tags.filter(function(tag){\n        return tag.content.title == title;\n      })[0];\n    }\n\n    function addTag(tag) {\n      tags.push(tag);\n    }\n\n    for(var xmlNote of xmlNotes) {\n      var title = xmlNote.getElementsByTagName(\"title\")[0].childNodes[0].nodeValue;\n      var created = xmlNote.getElementsByTagName(\"created\")[0].childNodes[0].nodeValue;\n      var updatedNodes = xmlNote.getElementsByTagName(\"updated\");\n      var updated = updatedNodes.length ? updatedNodes[0].childNodes[0].nodeValue : null;\n\n      var contentXmlString = xmlNote.getElementsByTagName(\"content\")[0].childNodes[0].nodeValue;\n      var contentXml = this.loadXMLString(contentXmlString, \"html\");\n      var contentHTML = contentXml.getElementsByTagName(\"en-note\")[0].innerHTML;\n      var text = this.strip(contentHTML);\n\n      var note = {\n        created_at: moment(created).toDate(),\n        updated_at: updated ? moment(updated).toDate() : null,\n        uuid: this.generateUUID(),\n        content_type: \"Note\",\n        content: {\n          title: title,\n          text: text,\n          references: [],\n        }\n      };\n\n      var xmlTags = xmlNote.getElementsByTagName(\"tag\");\n      for(var tagXml of xmlTags) {\n        var tagName = tagXml.childNodes[0].nodeValue;\n        var tag = findTag(tagName);\n        if(!tag) {\n          tag = {\n            uuid: this.generateUUID(),\n            content_type: \"Tag\",\n            created_at: new Date(),\n            updated_at: new Date(),\n            content: {\n              title: tagName,\n              references: []\n            }\n          }\n          addTag(tag);\n        }\n\n        note.content.references.push({content_type: tag.content_type, uuid: tag.uuid})\n        tag.content.references.push({content_type: note.content_type, uuid: note.uuid})\n      }\n\n      notes.push(note);\n    }\n\n    var itemsData = {\n      items: notes.concat(tags)\n    }\n\n    return itemsData;\n  }\n\n  convertPlaintextFiles(files, completion) {\n    var index = 0;\n    var processedData = [];\n\n    var readNext = function() {\n      var file = files[index];\n      index++;\n      var reader = new FileReader();\n\n      reader.onload = function(e) {\n\n        var data = e.target.result;\n        var note = {\n          created_at: new Date(),\n          updated_at: new Date(),\n          uuid: this.generateUUID(),\n          content_type: \"Note\",\n          content: {\n            title: file.name.split(\".\")[0],\n            text: data,\n            references: [],\n          }\n        };\n        processedData.push(note);\n\n        if(index < files.length) {\n          readNext();\n        } else {\n          completion({items: processedData});\n        }\n      }.bind(this)\n      reader.readAsText(file);\n    }.bind(this);\n\n    readNext();\n  }\n}\n\nwindow.SNTools = new SNTools()\n"]}